# 新功能說明 - 聲量分析與盤前資料

## 📰 新聞聲量分析區塊

### 功能說明
- **統計期間**：前24小時
- **功能**：自動統計哪些公司在新聞中出現頻率最高
- **顯示內容**：
  - 公司排名（前20名）
  - 公司名稱和股票代碼
  - 新聞出現次數

### 技術實現
- 使用 `yfinance` 獲取各標的的新聞
- 從新聞標題中提取公司名稱和股票代碼
- 統計出現頻率並排序

### API 端點
- `/api/news-volume` - 獲取新聞聲量分析

---

## 🌅 盤前資料區塊

### 功能說明

#### 台股盤前/盤後
- **盤前時間**：每天早上 8:30 之前
- **資料範圍**：前16小時的新聞
- **盤後時間**：8:30 之後
- **週末處理**：停留在週五的盤前資料

#### 美股盤前/盤後
- **盤前時間**：每天早上 9:30（美東時間）之前
- **資料範圍**：前16小時的新聞
- **盤後時間**：9:30 之後
- **週末處理**：停留在週五的盤前資料

### 顯示內容
- 市場類型（台股/美股）
- 狀態（盤前/盤後）
- 新聞數量
- 新聞列表（標題、發布時間、來源、連結）

### 技術實現
- 使用 `pytz` 處理時區（台灣時間、美東時間）
- 自動判斷是否為交易日
- 週末自動回退到上週五的資料
- 時間範圍過濾（前16小時）

### API 端點
- `/api/premarket-data` - 獲取盤前資料（包含台股和美股）

---

## 📁 新增檔案

### 後端模組
1. `news_analysis/__init__.py` - 模組初始化
2. `news_analysis/news_fetcher.py` - 新聞數據獲取
3. `news_analysis/volume_analyzer.py` - 聲量分析
4. `news_analysis/premarket_analyzer.py` - 盤前資料分析

### 前端更新
1. `templates/index.html` - 新增聲量和盤前資料區塊
2. `static/js/main.js` - 新增載入和顯示邏輯
3. `static/css/style.css` - 新增樣式

---

## 🔧 使用方式

### 1. 安裝新依賴
```bash
pip install pytz
```

### 2. 重啟系統
```bash
python app.py
```

### 3. 訪問網站
打開瀏覽器訪問 `http://localhost:5000`

您會看到：
- **新聞聲量分析區塊**：顯示前24小時新聞出現頻率最高的公司
- **盤前資料區塊**：顯示台股和美股盤前/盤後的新聞資料

---

## ⚙️ 配置說明

### 修改監控的公司
編輯 `config.py`，在以下字典中新增或修改：
- `US_MARKETS` - 美股標的
- `TW_MARKETS` - 台股標的
- `INTERNATIONAL_MARKETS` - 國際市場標的

### 調整時間範圍
- **聲量分析**：修改 `volume_analyzer.py` 中的 `hours` 參數（預設24小時）
- **盤前資料**：修改 `premarket_analyzer.py` 中的時間計算邏輯

---

## 📊 資料來源

- **新聞來源**：yfinance API
- **更新頻率**：每60秒自動刷新（可在 `main.js` 中調整）
- **緩存機制**：新聞數據緩存5分鐘，避免過度請求

---

## ⚠️ 注意事項

1. **API 限制**：yfinance 可能有請求頻率限制，系統已加入延遲機制
2. **時區處理**：系統自動處理台灣時間和美東時間的轉換
3. **週末處理**：週末會顯示上週五的盤前資料
4. **新聞匹配**：公司名稱匹配基於 `config.py` 中定義的公司名稱

---

## 🚀 未來擴展

可考慮新增：
- [ ] 更多新聞來源（如新聞API）
- [ ] 情感分析（正面/負面新聞）
- [ ] 新聞關鍵字提取
- [ ] 歷史聲量趨勢圖表
- [ ] 自訂監控公司列表

---

**祝使用愉快！** 📈

