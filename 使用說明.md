# 交易系統使用說明

## 📋 專案概述

這是一個智能交易系統，主要功能包括：
- 📊 **市場監控**：即時顯示美股、台股及主要國際市場盤勢
- ⏰ **擇時功能**：智能判斷最佳交易時機
- 🎯 **策略匹配**：自動選擇最適合當前市場環境的交易策略

## 🗂️ 檔案結構說明

### 主要檔案

#### 1. `app.py` - Flask 主應用程式
**功能**：這是整個系統的核心入口點，負責：
- 啟動 Flask Web 伺服器
- 定義所有 API 路由（端點）
- 整合各個模組（市場數據、擇時、策略）
- 提供前端頁面服務

**主要路由**：
- `/` - 首頁（顯示市場監控介面）
- `/api/market-data` - 獲取市場數據 API
- `/api/timing-analysis` - 獲取擇時分析 API
- `/api/strategy-recommendation/<symbol>` - 獲取特定標的的策略建議
- `/api/strategies` - 獲取所有可用策略列表

**如何使用**：
```bash
python app.py
```
然後在瀏覽器打開 `http://localhost:5000`

---

#### 2. `config.py` - 配置文件
**功能**：集中管理系統配置
- 定義要監控的市場代碼（美股、台股、國際市場）
- 設定 Flask 應用參數（端口、除錯模式等）
- 管理環境變數

**主要配置**：
- `US_MARKETS` - 美股市場代碼字典
- `TW_MARKETS` - 台股市場代碼字典
- `INTERNATIONAL_MARKETS` - 國際市場代碼字典
- `PORT` - Web 伺服器端口（預設 5000）
- `DEBUG` - 除錯模式開關

**如何修改**：直接編輯此檔案來新增或修改要監控的市場標的

---

#### 3. `market_data/data_fetcher.py` - 市場數據獲取模組
**功能**：從 yfinance API 獲取市場數據
- 獲取單一標的的市場數據（價格、成交量、漲跌幅等）
- 批量獲取多個市場數據
- 數據緩存機制（60秒緩存，避免過度請求）

**主要方法**：
- `get_market_data(symbol, period, interval)` - 獲取單一標的數據
- `get_multiple_markets(symbols, period)` - 批量獲取多個標的
- `get_market_summary()` - 獲取所有市場的總覽數據

**返回數據格式**：
```python
{
    'symbol': 'SPY',
    'name': 'SPDR S&P 500 ETF Trust',
    'current_price': 450.25,
    'previous_close': 448.50,
    'change': 1.75,
    'change_percent': 0.39,
    'volume': 50000000,
    'high': 451.00,
    'low': 449.00,
    'open': 449.50,
    'timestamp': '2024-01-01T12:00:00'
}
```

---

#### 4. `timing/timing_selector.py` - 擇時選擇器
**功能**：分析市場時機，判斷是否適合交易
- 根據價格變化、成交量等指標判斷市場趨勢
- 提供看漲（BULLISH）、看跌（BEARISH）、中性（NEUTRAL）信號
- 計算信心度

**主要方法**：
- `analyze_market_timing(market_data)` - 分析單一標的的擇時信號
- `get_timing_recommendation(market_summary)` - 獲取所有市場的擇時建議

**返回格式**：
```python
{
    'signal': 'BULLISH',  # 或 'BEARISH', 'NEUTRAL'
    'confidence': 75.5,   # 信心度 0-100
    'reason': '市場上漲 1.25%，成交量活躍',
    'timestamp': '2024-01-01T12:00:00'
}
```

**邏輯說明**：
- 漲幅 > 1% 且成交量 > 0 → 看漲
- 跌幅 > 1% → 看跌
- 其他情況 → 中性

---

#### 5. `strategy/strategy_matcher.py` - 策略匹配器
**功能**：根據市場環境和擇時信號，推薦最適合的交易策略

**內建策略**：
1. **動量策略 (momentum)** - 適合趨勢明確的市場
2. **均值回歸策略 (mean_reversion)** - 適合波動較大的震盪市場
3. **突破策略 (breakout)** - 適合關鍵價位突破時機
4. **趨勢跟隨策略 (trend_following)** - 適合明確趨勢方向

**主要方法**：
- `match_strategy(market_data, timing_signal)` - 匹配最適合的策略
- `get_all_strategies()` - 獲取所有可用策略列表

**返回格式**：
```python
{
    'recommended_strategy': 'momentum',
    'strategy_name': '動量策略',
    'strategy_description': '適合趨勢明確的市場環境',
    'confidence': 75,
    'reason': '強勁上漲趨勢，適合動量策略',
    'timestamp': '2024-01-01T12:00:00'
}
```

**匹配邏輯**：
- 看漲 + 漲幅 > 2% → 動量策略
- 看跌 + 跌幅 > 2% → 均值回歸策略
- 中性 + 波動 < 0.5% → 突破策略
- 看漲但漲幅較小 → 趨勢跟隨策略
- 其他 → 均值回歸策略

---

### 前端檔案

#### 6. `templates/index.html` - 主頁面模板
**功能**：顯示市場監控介面的 HTML 結構
- 包含三個市場區塊：美股、台股、國際市場
- 擇時分析區塊
- 自動刷新功能

---

#### 7. `static/css/style.css` - 樣式表
**功能**：定義網頁的外觀和樣式
- 響應式設計（支援手機、平板、電腦）
- 美觀的卡片式佈局
- 顏色編碼（綠色=上漲，紅色=下跌）

---

#### 8. `static/js/main.js` - 前端 JavaScript
**功能**：處理前端邏輯
- 從 API 獲取數據
- 動態更新頁面內容
- 每 60 秒自動刷新
- 手動刷新按鈕功能

---

## 🚀 快速開始

### 1. 安裝依賴套件

```bash
pip install -r requirements.txt
```

### 2. 設定環境變數（可選）

複製 `.env.example` 為 `.env` 並修改：
```bash
copy .env.example .env
```

### 3. 啟動應用程式

```bash
python app.py
```

### 4. 訪問網站

打開瀏覽器訪問：`http://localhost:5000`

---

## 📊 使用流程

1. **啟動系統** → 執行 `python app.py`
2. **查看市場數據** → 瀏覽器自動載入並顯示所有市場數據
3. **查看擇時分析** → 系統自動分析每個市場的時機
4. **獲取策略建議** → 可以透過 API 獲取特定標的的策略建議

---

## 🔧 擴展功能

### 如何新增監控標的

編輯 `config.py`，在對應的市場字典中新增：
```python
US_MARKETS = {
    'SPY': 'S&P 500',
    'QQQ': 'NASDAQ 100',
    'YOUR_SYMBOL': 'Your Stock Name'  # 新增這行
}
```

### 如何自訂擇時邏輯

編輯 `timing/timing_selector.py` 中的 `analyze_market_timing` 方法，加入你的判斷邏輯。

### 如何新增交易策略

編輯 `strategy/strategy_matcher.py`：
1. 在 `__init__` 的 `self.strategies` 字典中新增策略定義
2. 在 `match_strategy` 方法中加入匹配邏輯

---

## 🌐 部署到 GitHub

1. 初始化 Git 倉庫：
```bash
git init
```

2. 新增所有檔案：
```bash
git add .
```

3. 提交：
```bash
git commit -m "Initial commit: Trading System"
```

4. 在 GitHub 建立新倉庫，然後推送：
```bash
git remote add origin https://github.com/your-username/your-repo.git
git push -u origin main
```

**注意**：`.env` 檔案已被 `.gitignore` 排除，不會上傳到 GitHub（保護你的 API 金鑰）

---

## ❓ 常見問題

**Q: 為什麼某些市場數據顯示不出來？**
A: 可能是 yfinance API 暫時無法取得該標的數據，或標的代碼錯誤。

**Q: 如何修改更新頻率？**
A: 修改 `config.py` 中的 `DATA_UPDATE_INTERVAL`，或修改 `static/js/main.js` 中的 `setInterval` 時間。

**Q: 可以同時監控更多市場嗎？**
A: 可以，在 `config.py` 中新增更多標的即可。

---

## 📝 開發計劃

- [x] 基礎環境設置
- [x] 市場數據獲取
- [x] Web 介面
- [x] 擇時功能實現
- [x] 策略匹配算法
- [ ] 回測系統
- [ ] 風險管理模組
- [ ] 更多技術指標
- [ ] 歷史數據分析

---

## 📞 技術支援

如有問題，請查看：
- `README.md` - 專案說明
- 各模組的註解和文檔字符串

---

**祝交易順利！** 📈

