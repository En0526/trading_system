# 🚀 如何啟動/重啟交易系統

## 方法一：使用終端機（推薦）

### Windows 系統

#### 步驟 1：打開終端機
有幾種方式：
1. **PowerShell**：
   - 按 `Win + X`，選擇「Windows PowerShell」或「終端機」
   - 或按 `Win + R`，輸入 `powershell`，按 Enter

2. **命令提示字元（CMD）**：
   - 按 `Win + R`，輸入 `cmd`，按 Enter

3. **在檔案總管中開啟**：
   - 打開檔案總管，進入 `C:\trading_system` 資料夾
   - 在地址欄輸入 `powershell` 或 `cmd`，按 Enter
   - 或按住 `Shift` 鍵，在資料夾空白處右鍵，選擇「在此處開啟 PowerShell 視窗」

#### 步驟 2：切換到專案目錄
```powershell
cd C:\trading_system
```

#### 步驟 3：啟動系統
```powershell
python app.py
```

#### 步驟 4：查看輸出
如果成功啟動，您會看到類似這樣的訊息：
```
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://0.0.0.0:5000
```

---

## 方法二：在 VS Code 中啟動

### 如果您使用 VS Code：

1. **打開專案資料夾**
   - 打開 VS Code
   - 選擇「檔案」→「開啟資料夾」
   - 選擇 `C:\trading_system`

2. **打開終端機**
   - 按 `Ctrl + `` (反引號) 或
   - 選擇「終端機」→「新增終端機」

3. **執行啟動命令**
   ```bash
   python app.py
   ```

---

## 如何停止系統

### 在終端機中：
1. 將游標移到終端機視窗
2. 按 `Ctrl + C`
3. 系統會停止運行

---

## 如何重新啟動

### 如果系統正在運行：
1. **先停止系統**：在終端機按 `Ctrl + C`
2. **再啟動系統**：執行 `python app.py`

### 如果系統已停止：
直接執行 `python app.py` 即可

---

## 常見問題

### Q: 顯示「python 不是內部或外部命令」？
**A:** 需要確認 Python 已正確安裝並加入 PATH
- 檢查：在終端機輸入 `python --version`
- 如果沒有，請重新安裝 Python 並勾選「Add Python to PATH」

### Q: 顯示「端口已被使用」？
**A:** 可能有其他程式在使用端口 5000
- 方法1：停止其他使用該端口的程式
- 方法2：修改 `config.py` 中的 `PORT` 設定為其他端口（如 5001）

### Q: 如何確認系統是否在運行？
**A:** 
- 查看終端機是否有 Flask 的啟動訊息
- 打開瀏覽器訪問 `http://localhost:5000`
- 如果能看到網頁，表示系統正在運行

### Q: 法說會、三大法人 CSV 等「從本機讀檔」的資料，在 Cursor 改完要同步到 GitHub 嗎？
**A:** 要看你的網站是**在哪裡跑**：

| 網站跑在哪裡 | 你在 Cursor 改完之後 |
|-------------|----------------------|
| **只在你電腦跑**（`python app.py`，開 `http://localhost:5000`） | **存檔就好**，不用同步到 GitHub。程式是讀你電腦上的 `ir_csv`、`institutional_csv` 等資料夾，改完存檔、重新整理網頁（或重啟 app）就會用到新檔案。 |
| **跑在雲端**（例如 Render，別人用你給的網址連） | **要 push 到 GitHub 才有用**。雲端主機只會用「從 GitHub 拉下來」的那份程式與檔案。所以：在 Cursor 改完 → `git add .` → `git commit -m "更新法說會 CSV"` → `git push`，雲端會重新部署並讀到新檔案。 |

簡單記：**本機跑 = 在 Cursor 改就好；雲端跑 = 改完要 push 到 GitHub 雲端才會更新。**

---

## 快速啟動腳本（可選）

您可以建立一個批次檔來快速啟動：

### 建立 `start.bat` 檔案
在 `C:\trading_system` 資料夾中建立一個名為 `start.bat` 的檔案，內容如下：

```batch
@echo off
cd /d C:\trading_system
python app.py
pause
```

### 使用方式
雙擊 `start.bat` 檔案即可啟動系統

---

## 訪問網站

啟動成功後，打開瀏覽器訪問：
```
http://localhost:5000
```

---

## 誰可以使用這個網站？

系統已設定為 **監聽所有網路介面**（`host='0.0.0.0'`），依你的需求可分三種範圍：

### 1️⃣ 只有你這台電腦

- 在**本機**瀏覽器打開：`http://localhost:5000` 或 `http://127.0.0.1:5000`
- 不需額外設定

### 2️⃣ 同一個 WiFi / 家裡區網的人（例如家人、同事）

- **你的電腦**要先查「區域網路 IP」：
  - Windows：打開 CMD 或 PowerShell，輸入 `ipconfig`，找到 **IPv4 位址**（例如 `192.168.1.100`）
- **同一台 WiFi 或同網段**的其他人，在瀏覽器輸入：
  ```
  http://你的IP:5000
  ```
  例如：`http://192.168.1.100:5000`
- 注意：你的電腦要開著、系統要正在跑，且防火牆要允許 port 5000（Windows 若跳出「允許存取」要選允許）

**若其他電腦打開時美股／各大市場顯示「暫無數據」**：請先在**跑系統的那台電腦**上打開一次 `http://localhost:5000` 或 `http://你的IP:5000`，讓系統先抓完市場資料；之後其他電腦再開同一網址就會沿用快取，應可正常顯示。若仍沒有數據，請在畫面上按該區塊的「🔄 更新」再試。

### 3️⃣ 網際網路人人都能連（沒跟你同網路的人也能開）

要讓**不在你家／公司網路**的人（例如朋友、客戶、不同地點的家人）也能用，需要讓外網能連到你的服務，常見做法：

| 方式 | 說明 | 難度 |
|------|------|------|
| **ngrok** | 在你電腦跑一個隧道，會給你一個暫時的網址（如 `https://xxx.ngrok.io`），別人點就能連到你本機的 5000 port。適合測試、短期分享。 | 簡單 |
| **路由器埠轉發** | 在分享器設定「虛擬伺服器」或「埠轉發」，把外網的某 port 轉到你電腦的 5000。需有實體 IP 或 DDNS。 | 中等 |
| **部署到雲端** | 把程式放到 VPS（如 AWS、GCP、Linode）、或 Railway / Render / Fly.io 等，用他們的網址對外開放。 | 中等～較高 |

---

## 讓「沒跟你同網路的人」使用的具體做法

### 做法 A：ngrok（最快、適合短期分享）

1. **安裝 ngrok**
   - 到 [ngrok 官網](https://ngrok.com/) 註冊免費帳號
   - 下載 Windows 版並解壓，或用 Chocolatey：`choco install ngrok`

2. **先啟動你的交易系統**
   - 在專案目錄執行：`python app.py`，確認本機可開 `http://localhost:5000`

3. **開新終端機，執行隧道**
   ```powershell
   ngrok http 5000
   ```
   - 畫面上會出現一行 **Forwarding**，例如：`https://abc123.ngrok-free.app -> http://localhost:5000`

4. **把網址給別人**
   - 把 `https://xxxx.ngrok-free.app` 這串網址傳給對方（Line、Email 等）
   - 對方用瀏覽器打開該網址即可使用（不需和你同 WiFi）
   - 注意：你電腦要開著、`python app.py` 和 `ngrok http 5000` 都要保持運行；免費版 ngrok 每次重開網址會變

---

### 做法 B：部署到雲端（長期、穩定，你電腦可關機）

把程式放到雲端主機，會得到一個固定網址（例如 `https://你的專案名.onrender.com`），任何人隨時可連，且你本機可以關機。

**是免費的嗎？**  
**Render 有免費方案**，可以不付費使用，但有限制：
- **閒置會休眠**：約 15 分鐘沒人訪問，服務會暫停；下次有人打開時會自動醒來（可能需等約 1 分鐘）。
- **每月約 750 小時**：所有免費服務合計，一般個人小站足夠。
- **每月約 100 GB 流量**、約 500 分鐘建置時間，超過當月額度後服務會暫停，下個月會重置。
- 免費方案適合**個人／小量使用**；若要 24 小時不休眠、高流量，需改付費方案。

**前置：先把專案放上 GitHub**

雲端（Render、Railway 等）都是從 **GitHub 倉庫**拉程式來部署，所以要先完成這一步：

1. **安裝 Git**（若尚未安裝）  
   - 到 [git-scm.com](https://git-scm.com/) 下載 Windows 版並安裝。

2. **在 GitHub 建立新倉庫**  
   - 登入 [GitHub](https://github.com/)，點 **New repository**  
   - 倉庫名稱可填 `trading_system`（或自訂），**不要**勾選「Add a README」（專案已有檔案）  
   - 建立後會看到一個空倉庫，記下它的網址，例如：`https://github.com/你的帳號/trading_system.git`

3. **在本機專案目錄執行**（在 `C:\trading_system` 打開 PowerShell 或 CMD）：
   ```powershell
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/你的帳號/trading_system.git
   git push -u origin main
   ```
   - 把 `你的帳號/trading_system` 換成你剛建立的倉庫網址。  
   - 若 GitHub 要求登入，可用帳號密碼或 **Personal Access Token**（設定 → Developer settings → Personal access tokens）。

完成後，你的程式碼就在 GitHub 上了，再往下做 Render 部署即可。

---

**以 Render 為例（免費方案即可使用）：**

1. 到 [Render](https://render.com/) 註冊，選 **New → Web Service**
2. 連接到你的 **GitHub**，選剛推上去的倉庫（例如 `trading_system`）
3. 設定：
   - **Build Command**：`pip install -r requirements.txt`
   - **Start Command**：`gunicorn -b 0.0.0.0:$PORT app:app --workers 1 --timeout 180`（單 worker 省記憶體；timeout 180 秒避免新聞聲量/法人說明會等較慢 API 被殺而出現 502）
   - 若主機不支援 gunicorn，可改為：`python app.py`（需在環境變數設定 `PORT`）
4. 部署完成後，Render 會給一個網址，例如 `https://trading-system-xxxx.onrender.com`，把這網址分享給別人即可

**安全提醒**：若對外開放，建議在 `.env` 設定較強的 `SECRET_KEY`，且不要放敏感 API 金鑰在程式裡。

**選填環境變數（多資料源）**：  
- **FINNHUB_API_KEY**：美股與美股指數改由 Finnhub 取得（免費 60 次/分，[申請](https://finnhub.io/)）。未設則用 yfinance。  
- **TWELVEDATA_API_KEY**：重金屬期貨改由 Twelve Data 取得（免費 8 次/分，[申請](https://twelvedata.com/)）。未設則用 yfinance。  
- 台股維持 yfinance；加密貨幣一律用幣安（無需 key）。  
- **超過免費額度時**：API 會回傳 429（限流）並停止該次請求，**不會自動扣款**；要付費須自行升級方案。

---

- **只想快速讓別人試用**：用 **做法 A（ngrok）** 最簡單。
- **要長期、穩定給很多人用**：用 **做法 B（雲端部署）**，你的電腦不用一直開，也較安全。

---

**提示**：建議將終端機視窗保持開啟，這樣可以看到系統的運行狀態和錯誤訊息。

